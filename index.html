<!DOCTYPE html>
<html>
<head>
  <title>Kraepelin Test</title>
  <script>
    let answers = [];
    let currentQuestion = 0;
    let currentSet = 0;
    const sets = [
      ["Soal 1", "Soal 2", "Soal 3", "Soal 4", "Soal 5", "Soal 6", "Soal 7", "Soal 8", "Soal 9", "Soal 10", "Soal 11", "Soal 12", "Soal 13", "Soal 14", "Soal 15", "Soal 16", "Soal 17", "Soal 18", "Soal 19", "Soal 20", "Soal 21", "Soal 22", "Soal 23", "Soal 24", "Soal 25", "Soal 26", "Soal 27"],
      ["Soal 28", "Soal 29", "Soal 30", "Soal 31", "Soal 32", "Soal 33", "Soal 34", "Soal 35", "Soal 36", "Soal 37", "Soal 38", "Soal 39", "Soal 40", "Soal 41", "Soal 42", "Soal 43", "Soal 44"]
    ];
    let timer;

    function startTest() {
      document.getElementById("intro").style.display = "none";
      document.getElementById("test").style.display = "block";
      startSet();
    }

    function startSet() {
      currentQuestion = 0;
      showQuestion();
      startTimer();
    }

    function startTimer() {
      let timeLeft = 30; // 30 seconds per set
      document.getElementById("timer").innerText = `Waktu Tersisa: ${timeLeft} detik`;
      timer = setInterval(() => {
        timeLeft--;
        document.getElementById("timer").innerText = `Waktu Tersisa: ${timeLeft} detik`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          moveToNextSet();
        }
      }, 1000);
    }

    function showQuestion() {
      if (currentQuestion < sets[currentSet].length) {
        document.getElementById("question").innerText = sets[currentSet][currentQuestion];
      } else {
        clearInterval(timer);
        moveToNextSet();
      }
    }

    function submitAnswer() {
      const answer = document.getElementById("answer").value;
      answers.push(answer || ""); // Save answer or empty if skipped
      document.getElementById("answer").value = ""; // Clear input
      currentQuestion++;
      if (currentQuestion < sets[currentSet].length) {
        showQuestion();
      } else {
        clearInterval(timer);
        moveToNextSet();
      }
    }

    function moveToNextSet() {
      currentSet++;
      if (currentSet < sets.length) {
        startSet();
      } else {
        endTest();
      }
    }

    function endTest() {
      document.getElementById("test").style.display = "none";
      document.getElementById("thankyou").style.display = "block";
      sendToGoogleSheets();
    }

    function sendToGoogleSheets() {
      const data = {
        nama: document.getElementById("nama").value,
        tahunLahir: document.getElementById("tahunLahir").value,
        pendidikan: document.getElementById("pendidikan").value,
        jawaban: answers
      };

      fetch("https://script.google.com/macros/s/AKfycbxhfXga29OwECk5f_R2Oj1U7K5j2StjA9BO528Y36C7vfo4MayV-zrnZaJtPhu3Jn1hmg/exec", { // Ganti YOUR_WEB_APP_URL dengan URL dari Google Apps Script
        method: "POST",
        body: JSON.stringify(data),
        headers: {
          "Content-Type": "application/json",
        },
      })
      .then(response => response.text())
      .then(result => console.log(result))
      .catch(error => console.error("Error:", error));
    }
  </script>
</head>
<body>
  <div id="intro">
    <h1>Kraepelin Test</h1>
    <label>Nama: <input type="text" id="nama"></label><br>
    <label>Tahun Lahir: <input type="number" id="tahunLahir"></label><br>
    <label>Pendidikan: <input type="text" id="pendidikan"></label><br>
    <button onclick="startTest()">Mulai Tes</button>
  </div>

  <div id="test" style="display:none;">
    <p id="timer">Waktu Tersisa: 30 detik</p>
    <p id="question"></p>
    <input type="text" id="answer" onkeypress="if(event.key === 'Enter') submitAnswer()">
    <button onclick="submitAnswer()">Next</button>
  </div>

  <div id="thankyou" style="display:none;">
    <h2>Terima kasih telah mengikuti tes!</h2>
  </div>
</body>
</html>
