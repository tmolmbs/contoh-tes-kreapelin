<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kraepelin Test</title>
</head>
<body>
    <h1>Formulir Tes Kraepelin</h1>

    <!-- Formulir Pengenalan (Nama, Tahun Lahir, Pendidikan) -->
    <div id="formSection">
        <form id="kraepelinForm">
            <label for="nama">Nama Lengkap:</label><br>
            <input type="text" id="nama" name="nama" required><br><br>

            <label for="tahunLahir">Tahun Lahir:</label><br>
            <input type="number" id="tahunLahir" name="tahunLahir" required><br><br>

            <label for="pendidikan">Pendidikan Terakhir:</label><br>
            <select id="pendidikan" name="pendidikan" required>
                <option value="SMA">SMA</option>
                <option value="D3">D3</option>
                <option value="S1">S1</option>
                <option value="S2">S2</option>
            </select><br><br>

            <input type="submit" value="Mulai Tes">
        </form>
    </div>

    <!-- Soal Kraepelin -->
    <div id="testSection" style="display:none;">
        <h2>Soal Kraepelin</h2>
        <p>Isi setiap soal, dan pindah ke soal berikutnya setelah selesai. (Setiap soal memiliki waktu 30 detik).</p>

        <div id="soal-container"></div>

        <button id="submitTest" style="display:none;">Kirim Hasil Tes</button>
    </div>

    <script>
        // Data soal Kraepelin (27 soal)
        const soalKraepelin = [
            [4, 9], [6, 7], [2, 3], [5, 6], [3, 8], [1, 5], [2, 4], [7, 9],
            [8, 3], [5, 7], [6, 2], [4, 8], [3, 7], [9, 5], [1, 3], [6, 9],
            [4, 2], [7, 6], [3, 1], [9, 4], [2, 8], [5, 9], [8, 6], [1, 7],
            [3, 5], [6, 4], [7, 8]
        ];

        let currentSoalIndex = 0;
        let userAnswers = [];

        // Event handler untuk form pengenalan
        document.getElementById('kraepelinForm').onsubmit = function(event) {
            event.preventDefault(); // Mencegah form submit default
            
            // Mengambil data dari form
            const nama = document.getElementById('nama').value;
            const tahunLahir = document.getElementById('tahunLahir').value;
            const pendidikan = document.getElementById('pendidikan').value;

            // Menyembunyikan form pengenalan dan menampilkan soal
            document.getElementById('formSection').style.display = 'none';
            document.getElementById('testSection').style.display = 'block';

            // Mulai menampilkan soal
            displaySoal(nama, tahunLahir, pendidikan);
        };

        function displaySoal(nama, tahunLahir, pendidikan) {
            // Menampilkan soal pertama
            const soal = soalKraepelin[currentSoalIndex];
            const soalContainer = document.getElementById('soal-container');
            soalContainer.innerHTML = `
                <p>Soal ${currentSoalIndex + 1}: <b>${soal[0]} + ${soal[1]}</b></p>
                <input type="number" id="answer" placeholder="Jawaban" autofocus>
            `;
            document.getElementById('answer').focus();

            // Timer 30 detik per soal
            let timer = 30;
            const timerInterval = setInterval(() => {
                timer--;
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    // Pindah ke soal berikutnya
                    saveAnswer();
                    currentSoalIndex++;
                    if (currentSoalIndex < soalKraepelin.length) {
                        displaySoal(nama, tahunLahir, pendidikan);
                    } else {
                        // Semua soal selesai, tampilkan tombol kirim
                        document.getElementById('submitTest').style.display = 'block';
                    }
                }
            }, 1000);

            // Simpan jawaban saat berpindah ke soal berikutnya
            function saveAnswer() {
                const answer = document.getElementById('answer').value;
                if (answer) {
                    userAnswers.push(answer);
                } else {
                    userAnswers.push(null);
                }
            }
        }

        // Kirim hasil tes ke Google Sheets
        document.getElementById('submitTest').onclick = function() {
            const nama = document.getElementById('nama').value;
            const tahunLahir = document.getElementById('tahunLahir').value;
            const pendidikan = document.getElementById('pendidikan').value;

            // Kirim data ke Google Sheets melalui Web App
            const data = {
                nama: nama,
                tahunLahir: tahunLahir,
                pendidikan: pendidikan,
                answers: userAnswers.join(',') // Jawaban yang disimpan
            };

            fetch('https://script.google.com/macros/s/AKfycbxruV3FTAh2l9W-ID5Krsgn-cbPAx8K13HI4gPARJtAvdGhlGTQveVonk2eAMTkbO0AUA/exec', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(result => {
                alert('Hasil Tes Berhasil Dikirim!');
                window.location.reload(); // Segarkan halaman setelah kirim
            })
            .catch(error => {
                alert('Gagal mengirim data!');
                console.error('Error:', error);
            });
        };
    </script>
</body>
</html>
